name: Java Dependency Tree Diff

on:
  pull_request:
    types: [ labeled ]

jobs:
    build:
      runs-on: ubuntu-latest
      if: ${{ github.event.label.name == 'bot:java-dependency-tree' }}
      steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Import Secrets
        id: secrets
        uses: hashicorp/vault-action@v2.3.0
        with:
          url: ${{ secrets.VAULT_ADDR }}
          method: approle
          roleId: ${{ secrets.VAULT_ROLE_ID }}
          secretId: ${{ secrets.VAULT_SECRET_ID }}
          secrets: |
            secret/data/github.com/organizations/camunda NEXUS_USR;
            secret/data/github.com/organizations/camunda NEXUS_PSW;
      - uses: camunda/java-dependency-tree-diff@3441-use-jdk17
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          NEXUS_USR: ${{ steps.secrets.outputs.NEXUS_USR }}
          NEXUS_PSW: ${{ steps.secrets.outputs.NEXUS_PSW }}
