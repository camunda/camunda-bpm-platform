<?xml version='1.0' encoding='UTF-8'?>

<server xmlns="urn:jboss:domain:2.2">
  <extensions>
    <extension module="org.jboss.as.clustering.infinispan"/>
    <extension module="org.jboss.as.connector"/>
    <extension module="org.jboss.as.deployment-scanner"/>
    <extension module="org.jboss.as.ee"/>
    <extension module="org.jboss.as.ejb3"/>
    <extension module="org.jboss.as.jaxrs"/>
    <extension module="org.jboss.as.jdr"/>
    <extension module="org.jboss.as.jmx"/>
    <extension module="org.jboss.as.jpa"/>
    <extension module="org.jboss.as.jsf"/>
    <extension module="org.jboss.as.logging"/>
    <extension module="org.jboss.as.mail"/>
    <extension module="org.jboss.as.naming"/>
    <extension module="org.jboss.as.pojo"/>
    <extension module="org.jboss.as.remoting"/>
    <extension module="org.jboss.as.sar"/>
    <extension module="org.jboss.as.security"/>
    <extension module="org.jboss.as.transactions"/>
    <extension module="org.jboss.as.webservices"/>
    <extension module="org.jboss.as.weld"/>
    <extension module="org.wildfly.extension.batch"/>
    <extension module="org.wildfly.extension.io"/>
    <extension module="org.wildfly.extension.undertow"/>
    <extension module="org.jboss.as.threads"/>
    <extension module="org.camunda.bpm.wildfly.camunda-wildfly-subsystem"/>
  </extensions>
  <management>
    <security-realms>
      <security-realm name="ManagementRealm">
        <authentication>
          <local default-user="$local" skip-group-loading="true"/>
          <properties path="mgmt-users.properties" relative-to="jboss.server.config.dir"/>
        </authentication>
        <authorization map-groups-to-roles="false">
          <properties path="mgmt-groups.properties" relative-to="jboss.server.config.dir"/>
        </authorization>
      </security-realm>
      <security-realm name="ApplicationRealm">
        <authentication>
          <local default-user="$local" allowed-users="*" skip-group-loading="true"/>
          <properties path="application-users.properties" relative-to="jboss.server.config.dir"/>
        </authentication>
        <authorization>
          <properties path="application-roles.properties" relative-to="jboss.server.config.dir"/>
        </authorization>
      </security-realm>
    </security-realms>
    <audit-log>
      <formatters>
        <json-formatter name="json-formatter"/>
      </formatters>
      <handlers>
        <file-handler name="file" formatter="json-formatter" relative-to="jboss.server.data.dir" path="audit-log.log"/>
      </handlers>
      <logger log-boot="true" log-read-only="false" enabled="false">
        <handlers>
          <handler name="file"/>
        </handlers>
      </logger>
    </audit-log>
    <management-interfaces>
      <http-interface security-realm="ManagementRealm" http-upgrade-enabled="true">
        <socket-binding http="management-http"/>
      </http-interface>
    </management-interfaces>
    <access-control provider="simple">
      <role-mapping>
        <role name="SuperUser">
          <include>
            <user name="$local"/>
          </include>
        </role>
      </role-mapping>
    </access-control>
  </management>
  <profile>
    <subsystem xmlns="urn:jboss:domain:logging:2.0">
      <console-handler name="CONSOLE">
        <level name="INFO"/>
        <formatter>
          <named-formatter name="COLOR-PATTERN"/>
        </formatter>
      </console-handler>
      <periodic-rotating-file-handler name="FILE" autoflush="true">
        <formatter>
          <named-formatter name="PATTERN"/>
        </formatter>
        <file relative-to="jboss.server.log.dir" path="server.log"/>
        <suffix value=".yyyy-MM-dd"/>
        <append value="true"/>
      </periodic-rotating-file-handler>
      <logger category="com.arjuna">
        <level name="WARN"/>
      </logger>
      <logger category="org.apache.tomcat.util.modeler">
        <level name="WARN"/>
      </logger>
      <logger category="org.jboss.as.config">
        <level name="DEBUG"/>
      </logger>
      <logger category="sun.rmi">
        <level name="WARN"/>
      </logger>
      <logger category="jacorb">
        <level name="WARN"/>
      </logger>
      <logger category="jacorb.config">
        <level name="ERROR"/>
      </logger>
      <root-logger>
        <level name="INFO"/>
        <handlers>
          <handler name="CONSOLE"/>
          <handler name="FILE"/>
        </handlers>
      </root-logger>
      <formatter name="PATTERN">
        <pattern-formatter pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n"/>
      </formatter>
      <formatter name="COLOR-PATTERN">
        <pattern-formatter pattern="%K{level}%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n"/>
      </formatter>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:batch:1.0">
      <job-repository>
        <in-memory/>
      </job-repository>
      <thread-pool>
        <max-threads count="10"/>
        <keepalive-time time="30" unit="seconds"/>
      </thread-pool>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:datasources:2.0">
      <datasources>
        <drivers>
          <!-- all drivers needed in QA are listed here -->
          <!-- datasource definitions are deployed as *-ds.xml files -->
          <driver name="h2" module="com.h2database.h2">
            <xa-datasource-class>org.h2.jdbcx.JdbcDataSource</xa-datasource-class>
          </driver>
          <driver name="db2" module="com.ibm.db2.jcc.db2jcc4">
            <xa-datasource-class>com.ibm.db2.jcc.DB2XADataSource</xa-datasource-class>
          </driver>
          <driver name="com.microsoft.sqlserver" module="com.microsoft.sqlserver.sqljdbc4">
            <xa-datasource-class>com.microsoft.sqlserver.jdbc.SQLServerXADataSource</xa-datasource-class>
          </driver>
          <driver name="org.mariadb" module="org.mariadb.jdbc.mariadb-java-client">
            <xa-datasource-class>org.mariadb.jdbc.MySQLDataSource</xa-datasource-class>
          </driver>
          <driver name="com.mysql" module="mysql.mysql-connector-java">
            <xa-datasource-class>com.mysql.jdbc.jdbc2.optional.MysqlXADataSource</xa-datasource-class>
          </driver>
          <driver name="com.oracle.jdbc.ojdbc6" module="com.oracle.jdbc.ojdbc6">
            <xa-datasource-class>oracle.jdbc.xa.client.OracleXADataSource</xa-datasource-class>
          </driver>
          <driver name="postgresql" module="org.postgresql.postgresql">
            <xa-datasource-class>org.postgresql.xa.PGXADataSource</xa-datasource-class>
          </driver>
        </drivers>
      </datasources>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:deployment-scanner:2.0">
      <deployment-scanner path="deployments" relative-to="jboss.server.base.dir" scan-interval="5000" runtime-failure-causes-rollback="${jboss.deployment.scanner.rollback.on.failure:false}"/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:ee:2.0">
      <spec-descriptor-property-replacement>false</spec-descriptor-property-replacement>
      <concurrent>
        <context-services>
          <context-service name="default" jndi-name="java:jboss/ee/concurrency/context/default" use-transaction-setup-provider="true"/>
        </context-services>
        <managed-executor-services>
          <managed-executor-service name="default" jndi-name="java:jboss/ee/concurrency/executor/default" context-service="default" hung-task-threshold="60000" core-threads="5" max-threads="25" keepalive-time="5000"/>
        </managed-executor-services>
        <managed-scheduled-executor-services>
          <managed-scheduled-executor-service name="default" jndi-name="java:jboss/ee/concurrency/scheduler/default" context-service="default" hung-task-threshold="60000" core-threads="2" keepalive-time="3000"/>
        </managed-scheduled-executor-services>
        <managed-thread-factories>
          <managed-thread-factory name="default" jndi-name="java:jboss/ee/concurrency/factory/default" context-service="default"/>
        </managed-thread-factories>
      </concurrent>
      <default-bindings context-service="java:jboss/ee/concurrency/context/default" datasource="java:jboss/datasources/ExampleDS" jms-connection-factory="java:jboss/DefaultJMSConnectionFactory" managed-executor-service="java:jboss/ee/concurrency/executor/default" managed-scheduled-executor-service="java:jboss/ee/concurrency/scheduler/default" managed-thread-factory="java:jboss/ee/concurrency/factory/default"/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:ejb3:2.0">
      <session-bean>
        <stateful default-access-timeout="5000" cache-ref="simple" passivation-disabled-cache-ref="simple"/>
        <singleton default-access-timeout="5000"/>
      </session-bean>
      <pools>
        <bean-instance-pools>
          <!-- A sample strict max pool configuration -->
          <strict-max-pool name="slsb-strict-max-pool" max-pool-size="20" instance-acquisition-timeout="5" instance-acquisition-timeout-unit="MINUTES"/>
          <strict-max-pool name="mdb-strict-max-pool" max-pool-size="20" instance-acquisition-timeout="5" instance-acquisition-timeout-unit="MINUTES"/>
        </bean-instance-pools>
      </pools>
      <caches>
        <cache name="simple"/>
        <cache name="distributable" aliases="passivating clustered" passivation-store-ref="infinispan"/>
      </caches>
      <passivation-stores>
        <passivation-store name="infinispan" cache-container="ejb" max-size="10000"/>
      </passivation-stores>
      <async thread-pool-name="default"/>
      <timer-service thread-pool-name="default" default-data-store="default-file-store">
        <data-stores>
          <file-data-store name="default-file-store" path="timer-service-data" relative-to="jboss.server.data.dir"/>
        </data-stores>
      </timer-service>
      <remote connector-ref="http-remoting-connector" thread-pool-name="default"/>
      <thread-pools>
        <thread-pool name="default">
          <max-threads count="10"/>
          <keepalive-time time="100" unit="milliseconds"/>
        </thread-pool>
      </thread-pools>
      <default-security-domain value="other"/>
      <default-missing-method-permissions-deny-access value="true"/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:io:1.1">
      <worker name="default"/>
      <buffer-pool name="default"/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:infinispan:2.0">
      <cache-container name="web" default-cache="passivation" module="org.wildfly.clustering.web.infinispan">
        <local-cache name="passivation" batching="true">
          <file-store passivation="true" purge="false"/>
        </local-cache>
        <local-cache name="persistent" batching="true">
          <file-store passivation="false" purge="false"/>
        </local-cache>
      </cache-container>
      <cache-container name="ejb" aliases="sfsb" default-cache="passivation" module="org.wildfly.clustering.ejb.infinispan">
        <local-cache name="passivation" batching="true">
          <file-store passivation="true" purge="false"/>
        </local-cache>
        <local-cache name="persistent" batching="true">
          <file-store passivation="false" purge="false"/>
        </local-cache>
      </cache-container>
      <cache-container name="hibernate" default-cache="local-query" module="org.hibernate">
        <local-cache name="entity">
          <transaction mode="NON_XA"/>
          <eviction strategy="LRU" max-entries="10000"/>
          <expiration max-idle="100000"/>
        </local-cache>
        <local-cache name="local-query">
          <transaction mode="NONE"/>
          <eviction strategy="LRU" max-entries="10000"/>
          <expiration max-idle="100000"/>
        </local-cache>
        <local-cache name="timestamps">
          <transaction mode="NONE"/>
          <eviction strategy="NONE"/>
        </local-cache>
      </cache-container>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:jaxrs:1.0"/>
    <subsystem xmlns="urn:jboss:domain:jca:2.0">
      <archive-validation enabled="true" fail-on-error="true" fail-on-warn="false"/>
      <bean-validation enabled="true"/>
      <default-workmanager>
        <short-running-threads>
          <core-threads count="50"/>
          <queue-length count="50"/>
          <max-threads count="50"/>
          <keepalive-time time="10" unit="seconds"/>
        </short-running-threads>
        <long-running-threads>
          <core-threads count="50"/>
          <queue-length count="50"/>
          <max-threads count="50"/>
          <keepalive-time time="10" unit="seconds"/>
        </long-running-threads>
      </default-workmanager>
      <cached-connection-manager/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:jdr:1.0"/>
    <subsystem xmlns="urn:jboss:domain:jmx:1.3">
      <expose-resolved-model/>
      <expose-expression-model/>
      <remoting-connector/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:jpa:1.1">
      <jpa default-datasource="" default-extended-persistence-inheritance="DEEP"/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:jsf:1.0"/>
    <subsystem xmlns="urn:jboss:domain:mail:2.0">
      <mail-session name="default" jndi-name="java:jboss/mail/Default">
        <smtp-server outbound-socket-binding-ref="mail-smtp"/>
      </mail-session>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:naming:2.0">
      <remote-naming/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:pojo:1.0"/>
    <subsystem xmlns="urn:jboss:domain:remoting:2.0">
      <endpoint worker="default"/>
      <http-connector name="http-remoting-connector" connector-ref="default" security-realm="ApplicationRealm"/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:resource-adapters:2.0"/>
    <subsystem xmlns="urn:jboss:domain:sar:1.0"/>
    <subsystem xmlns="urn:jboss:domain:security:1.2">
      <security-domains>
        <security-domain name="other" cache-type="default">
          <authentication>
            <login-module code="Remoting" flag="optional">
              <module-option name="password-stacking" value="useFirstPass"/>
            </login-module>
            <login-module code="RealmDirect" flag="required">
              <module-option name="password-stacking" value="useFirstPass"/>
            </login-module>
          </authentication>
        </security-domain>
        <security-domain name="jboss-web-policy" cache-type="default">
          <authorization>
            <policy-module code="Delegating" flag="required"/>
          </authorization>
        </security-domain>
        <security-domain name="jboss-ejb-policy" cache-type="default">
          <authorization>
            <policy-module code="Delegating" flag="required"/>
          </authorization>
        </security-domain>
      </security-domains>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:transactions:2.0">
      <core-environment>
        <process-id>
          <uuid/>
        </process-id>
      </core-environment>
      <recovery-environment socket-binding="txn-recovery-environment" status-socket-binding="txn-status-manager"/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:undertow:1.2">
      <buffer-cache name="default"/>
      <server name="default-server">
        <http-listener name="default" socket-binding="http"/>
        <host name="default-host" alias="localhost">
          <location name="/" handler="welcome-content"/>
          <filter-ref name="server-header"/>
          <filter-ref name="x-powered-by-header"/>
        </host>
      </server>
      <servlet-container name="default">
        <jsp-config/>
        <websockets/>
      </servlet-container>
      <handlers>
        <file name="welcome-content" path="${jboss.home.dir}/welcome-content"/>
      </handlers>
      <filters>
        <response-header name="server-header" header-name="Server" header-value="WildFly/8"/>
        <response-header name="x-powered-by-header" header-name="X-Powered-By" header-value="Undertow/1"/>
      </filters>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:webservices:1.2">
      <wsdl-host>${jboss.bind.address:127.0.0.1}</wsdl-host>
      <endpoint-config name="Standard-Endpoint-Config"/>
      <endpoint-config name="Recording-Endpoint-Config">
        <pre-handler-chain name="recording-handlers" protocol-bindings="##SOAP11_HTTP ##SOAP11_HTTP_MTOM ##SOAP12_HTTP ##SOAP12_HTTP_MTOM">
          <handler name="RecordingHandler" class="org.jboss.ws.common.invocation.RecordingServerHandler"/>
        </pre-handler-chain>
      </endpoint-config>
      <client-config name="Standard-Client-Config"/>
    </subsystem>
    <subsystem xmlns="urn:jboss:domain:weld:2.0"/>
    <subsystem xmlns="urn:jboss:domain:threads:1.1">
      <bounded-queue-thread-pool name="job-executor-tp" allow-core-timeout="true">
        <core-threads count="3" />
        <queue-length count="3" />
        <max-threads count="10" />
        <keepalive-time time="10" unit="seconds" />
      </bounded-queue-thread-pool>
    </subsystem>
    <subsystem xmlns="urn:org.camunda.bpm.jboss:1.1">
      <process-engines>
        <process-engine name="default" default="true">
          <datasource>java:jboss/datasources/ProcessEngine</datasource>
          <history-level>full</history-level>
          <properties>
            <property name="jobExecutorAcquisitionName">default</property>
            <property name="isAutoSchemaUpdate">true</property>
            <property name="authorizationEnabled">true</property>
            <property name="jobExecutorDeploymentAware">true</property>
          </properties>
          <plugins>

            <!-- plugin enabling Process Application event listener support -->
            <plugin>
              <class>org.camunda.bpm.application.impl.event.ProcessApplicationEventListenerPlugin</class>
            </plugin>
            <!-- plugin enabling integration of camunda Spin -->
            <plugin>
              <class>org.camunda.spin.plugin.impl.SpinProcessEnginePlugin</class>
            </plugin>
            <!-- plugin enabling connect support -->
            <plugin>
              <class>org.camunda.connect.plugin.impl.ConnectProcessEnginePlugin</class>
            </plugin>

            <!-- LDAP CONFIGURATION -->
            <!-- Uncomment this section in order to enable LDAP support for this process engine -->
            <!-- Adjust configuration, see ( http://docs.camunda.org/latest/guides/user-guide/#process-engine-identity-service-the-ldap-identity-service ) -->
            <!--
              <plugin>
                <class>org.camunda.bpm.identity.impl.ldap.plugin.LdapIdentityProviderPlugin</class>
                <properties>

                  <property name="serverUrl">ldaps://localhost:4334/</property>
                  <property name="acceptUntrustedCertificates">false</property>
                  <property name="managerDn">uid=jonny,ou=office-berlin,o=camunda,c=org</property>
                  <property name="managerPassword">s3cr3t</property>

                  <property name="baseDn">o=camunda,c=org</property>

                  <property name="userSearchBase">ou=employees</property>
                  <property name="userSearchFilter">(objectclass=person)</property>

                  <property name="userIdAttribute">uid</property>
                  <property name="userFirstnameAttribute">cn</property>
                  <property name="userLastnameAttribute">sn</property>
                  <property name="userEmailAttribute">mail</property>
                  <property name="userPasswordAttribute">userpassword</property>

                  <property name="groupSearchBase">ou=roles</property>
                  <property name="groupSearchFilter">(objectclass=groupOfNames)</property>
                  <property name="groupIdAttribute">cn</property>
                  <property name="groupNameAttribute">cn</property>

                  <property name="groupMemberAttribute">member</property>

                </properties>
              </plugin>
              -->

            <!-- LDAP CONFIGURATION -->
            <!-- The following plugin allows you to grant administrator authorizations to an existing LDAP user -->
            <!--
            <plugin>
              <class>org.camunda.bpm.engine.impl.plugin.AdministratorAuthorizationPlugin</class>
              <properties>
                <property name="administratorUserName">admin</property>
              </properties>
            </plugin>
            -->
          </plugins>
        </process-engine>
      </process-engines>
      <job-executor>
        <thread-pool-name>job-executor-tp</thread-pool-name>
        <job-acquisitions>
          <job-acquisition name="default">
            <acquisition-strategy>SEQUENTIAL</acquisition-strategy>
            <properties>
              <property name="lockTimeInMillis">300000</property>
              <property name="waitTimeInMillis">5000</property>
              <property name="maxJobsPerAcquisition">3</property>
            </properties>
          </job-acquisition>
          <job-acquisition name="second">
            <acquisition-strategy>SEQUENTIAL</acquisition-strategy>
          </job-acquisition>
          <job-acquisition name="third">
            <acquisition-strategy>SEQUENTIAL</acquisition-strategy>
          </job-acquisition>
        </job-acquisitions>
      </job-executor>
    </subsystem>
  </profile>
  <interfaces>
    <interface name="management">
      <inet-address value="${jboss.bind.address.management:127.0.0.1}"/>
    </interface>
    <interface name="public">
      <inet-address value="${jboss.bind.address:127.0.0.1}"/>
    </interface>
    <!-- TODO - only show this if the jacorb subsystem is added  -->
    <interface name="unsecure">
      <!--
        ~  Used for IIOP sockets in the standard configuration.
        ~                  To secure JacORB you need to setup SSL
        -->
      <inet-address value="${jboss.bind.address.unsecure:127.0.0.1}"/>
    </interface>
  </interfaces>
  <socket-binding-group name="standard-sockets" default-interface="public" port-offset="0">
    <socket-binding name="management-http" interface="management" port="${jboss.management-http.port}"/>
    <socket-binding name="management-https" interface="management" port="${jboss.management-https.port}"/>
    <socket-binding name="ajp" port="${jboss.ajp.port}"/>
    <socket-binding name="http" port="${jboss.http.port}"/>
    <socket-binding name="https" port="${jboss.https.port}"/>
    <socket-binding name="txn-recovery-environment" port="${jboss.txn-recovery-environment.port}"/>
    <socket-binding name="txn-status-manager" port="${jboss.txn-status-manager.port}"/>
    <outbound-socket-binding name="mail-smtp">
      <remote-destination host="localhost" port="${jboss.mail-smtp.port}"/>
    </outbound-socket-binding>
  </socket-binding-group>
</server>
