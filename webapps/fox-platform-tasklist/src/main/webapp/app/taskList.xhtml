<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  template="/WEB-INF/templates/template.xhtml">

  <!-- Top Navigation Bar -->
  <ui:define name="nav-top-content">

    <div class="btn-group pull-right">
      <a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><i
        class="icon-user"></i> <h:outputText value="&#160;" /> <h:outputText
          value="#{identity.currentUser.username} " /><span
        class="caret"></span></a>
      <ul class="dropdown-menu">
      	<!-- Not yet used
        <li><a href="#">Profile</a></li>
        <li class="divider"></li>
         -->
        <li><h:form style="margin:0;">
            <h:commandLink action="#{identity.signOut()}">Sign out</h:commandLink>
          </h:form></li>
      </ul>
    </div>
    <div class="btn-group pull-right">
      <a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><i
        class="icon-play"></i> Start Process... <span class="caret"></span></a>
      <ul class="dropdown-menu">
        <ui:repeat value="#{processStarter.deployedProcesses}"
          var="item">
          <li><h:form style="margin:0;">
              <h:commandLink
                id="processStarterLink"
                action="#{processStarter.startProcess(item)}"
                value="#{item.name}" />
                <h:message for="processStarterLink" />
            </h:form></li>
        </ui:repeat>
      </ul>
    </div>
  </ui:define>
  <!-- /Top Navigation Bar -->

  <!-- Task Navigation -->
  <ui:define name="nav-left-content">
    <h:form style="margin:0;" id="taskNavigation" prependId="false">
      <ul class="nav nav-list">
        <li class="nav-header">Tasks</li>
        <li class="#{taskNavigation.myTasksLink.active ? 'active' : ''}">
          <h:commandLink
            action="#{taskNavigation.select(taskNavigation.myTasksLink)}"
            value="#{taskNavigation.myTasksLink.label}">
            <f:ajax render=":taskListView :taskNavigation" />
          </h:commandLink>
        </li>
        <h:panelGroup rendered="#{taskNavigation.unassignedTasksLink.count>0}">
        <li
	            class="#{taskNavigation.unassignedTasksLink.active ? 'active' : ''}">
	            <h:commandLink
	            	value="#{taskNavigation.unassignedTasksLink.label}"
	            	action="#{taskNavigation.select(taskNavigation.unassignedTasksLink)}">
	            	<f:ajax render=":taskListView :taskNavigation" />
	          </h:commandLink>
	    </li></h:panelGroup>
        <li class="nav-header">Group Tasks</li>
        <ui:repeat value="#{taskNavigation.groupTasksLinks}" var="item">
          <li class="#{item.active ? 'active' : ''}"><h:commandLink
              value="#{item.label}"
              action="#{taskNavigation.select(item)}">
              <f:ajax render=":taskListView :taskNavigation" />
            </h:commandLink></li>
        </ui:repeat>
        <li class="nav-header">Colleagues</li>
        <ui:repeat value="#{taskNavigation.colleaguesTasksLinks}"
          var="item">
          <li class="#{item.active ? 'active' : ''}"><h:commandLink
              value="#{item.label}"
              action="#{taskNavigation.select(item)}">
              <f:ajax render=":taskListView :taskNavigation" />
            </h:commandLink></li>
        </ui:repeat>
      </ul>
    </h:form>
  </ui:define>
  <!-- /Task Navigation -->

  <!-- Task List -->
  <ui:define name="content">
    <h:form id="taskListView">
	<div class="row">
		<div class="span2">
			<strong>Task</strong>
		</div>
		<div class="span2">
			<strong>Process</strong>
		</div>
		<div class="span2">
			<strong>Creation Date</strong>
		</div>
		<div class="span3">
			<strong>Action</strong>
		</div>
		<div class="span2">
			<strong>Delegate To</strong>
		</div>
	</div>
	<ui:repeat value="#{taskList.tasks}" var="task">
			<div class="row">
				<div class="span2">
					<h:outputText value="#{task.name} "/>
				</div>
				<div class="span2">
					 <h:outputText value="#{taskList.getProcessDefinition(task.processDefinitionId).name}" />
				</div>
				<div class="span2">
					 <h:outputText value="#{task.createTime}" >
           					<f:convertDateTime pattern="yyyy-MMM-dd HH:mm" /> 
					 </h:outputText>
				</div>
				<h:panelGroup rendered="#{taskList.isPersonalTask(task)}">
					<div class="span3">
	                	<h:outputLink value="#{taskList.getTaskFormUrl(task)}" rendered="#{taskList.getTaskFormUrl(task) != null}">work on task &#187;</h:outputLink>
	                	<h:outputText value="no task form provided" rendered="#{taskList.getTaskFormUrl(task) == null}" />
					</div>
					<div class="span2">
	                	<h:commandLink action="#{taskList.delegate(task)}" value="do" />
	                	<h:selectOneMenu value="#{taskList.delegateToColleague}">
							<f:selectItems value="#{taskList.colleages}" var="user" itemLabel="#{user.firstname} #{user.lastname}" itemValue="#{user.username}" />
	                	</h:selectOneMenu>
	                </div>
                </h:panelGroup>
                <h:panelGroup rendered="#{!taskList.isPersonalTask(task)}">
					<div class="span3">
		                <h:commandLink value="claim" action="#{taskList.claimTask(task)}" />
		            </div>
                </h:panelGroup>
			</div>
		</ui:repeat>      
    </h:form>

  </ui:define>
  <!-- /Task List -->

</ui:composition>
